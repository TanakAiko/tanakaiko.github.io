<div class="relative min-h-full pb-20">
  
  <!-- Top Bar / Search Overlay -->
  <div class="absolute top-0 left-0 right-0 z-40 p-6 flex justify-between items-center bg-gradient-to-b from-[#1a1f26]/90 to-transparent">
    <div class="text-2xl font-bold tracking-tight text-white/90">
      Movie Explorer <span class="text-gray-400 font-light">Home</span>
    </div>
    
    <div class="flex items-center gap-4 ml-auto">
        <!-- Search Bar -->
        <div class="glass-panel rounded-full px-4 h-11 flex items-center w-full max-w-xs md:max-w-md transition-all duration-300 hover:scale-105 focus-within:scale-105 hover:shadow-[0_0_15px_rgba(0,168,197,0.4)] hover:border-[#00a8c5]/50 group">
          <input #searchInput type="text" placeholder="Search for Movie" 
                 class="bg-transparent border-none outline-none text-sm text-white w-full px-2 placeholder-gray-400 h-full"
                 (keydown.enter)="navigateToSearch(searchInput.value)">
          <button (click)="navigateToSearch(searchInput.value)" class="p-2 text-white/80 group-hover:text-[#00a8c5] transition-colors flex items-center justify-center cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
            </svg>
          </button>
        </div>

        <!-- Login Indicator / User Menu -->
        @if (!authService.isLoggedIn()) {
          <a routerLink="/auth" class="bg-[#00a8c5] hover:bg-[#0097b2] text-white px-6 h-11 rounded-full font-bold shadow-lg shadow-[#00a8c5]/20 transition-all flex items-center gap-2 whitespace-nowrap">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
            </svg>
            Login
          </a>
        } @else {
          <div class="relative group">
            <button class="w-11 h-11 rounded-full bg-gradient-to-tr from-[#00a8c5] to-cyan-600 flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white/10 hover:ring-[#00a8c5] transition-all">
               <span class="text-lg">{{ authService.currentUser()?.username?.charAt(0)?.toUpperCase() }}</span>
            </button>
            <div class="absolute right-0 mt-2 w-48 bg-[#252b36] rounded-xl shadow-xl border border-white/5 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right z-50">
              <div class="px-4 py-3 border-b border-white/5">
                <p class="text-sm text-white font-bold truncate">{{ authService.currentUser()?.username }}</p>
                <a routerLink="/profile" class="text-xs text-[#00a8c5] hover:underline cursor-pointer block mt-1">View Profile</a>
              </div>
              <button (click)="authService.logout()" class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-white/5 transition-colors rounded-b-xl">
                Sign out
              </button>
            </div>
          </div>
        }
    </div>
  </div>

  <!-- Hero Section (Dynamic with Animation) -->
  @if (heroMovie(); as activeMovie) {
    <!-- We track by tmdbId to force the DOM to recreate, triggering the enter animations -->
    @for (movie of [activeMovie]; track movie.tmdbId) {
      <div class="relative w-full h-[85vh] overflow-hidden">
        <div class="absolute inset-0 bg-black animate-hero-bg">
           <img 
            [src]="movie.backdrop" 
            alt="Hero Backdrop"
            class="object-cover opacity-60 w-full h-full"
          >
        </div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#1a1f26] via-[#1a1f26]/40 to-transparent"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-[#1a1f26] via-[#1a1f26]/30 to-transparent"></div>

        <div class="absolute bottom-0 left-0 p-12 w-full max-w-4xl z-10">
          <h1 class="text-7xl font-black text-white uppercase tracking-tighter leading-[0.9] mb-4 drop-shadow-lg animate-content">
            {{movie.title.split(':')[0]}}<br>
            <span class="text-[#00a8c5]">{{movie.title.split(':')[1] || ''}}</span>
          </h1>
          
          <div class="flex items-center gap-4 text-gray-300 text-sm font-medium mb-8 animate-content delay-100">
            <span>{{movie.year}}</span>
            <span class="w-1 h-1 bg-gray-500 rounded-full"></span>
            <span class="text-[#00a8c5] font-bold">★ {{movie.rating.toFixed(1)}}</span>
          </div>

          <p class="text-lg text-gray-200 mb-8 max-w-2xl line-clamp-3 leading-relaxed drop-shadow-md animate-content delay-200">
            {{movie.description}}
          </p>

          <div class="flex gap-4 animate-content delay-300">
             @if (authService.isLoggedIn()) {
               <button (click)="toggleWatchlist(movie)" 
                       class="glass-panel text-white px-8 py-3 rounded-xl font-semibold hover:bg-white/10 transition-all flex items-center gap-2"
                       [class.bg-white-10]="isInWatchlist(movie.tmdbId)"
                       >
                 @if (isInWatchlist(movie.tmdbId)) {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 text-[#00a8c5]">
                      <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 01.208 1.04l-9 13.5a.75.75 0 01-1.154.114l-6-6a.75.75 0 011.06-1.06l5.353 5.353 8.493-12.739a.75.75 0 011.04-.208z" clip-rule="evenodd" />
                    </svg>
                    <span>In Watchlist</span>
                 } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                    </svg>
                    <span>Add to Watchlist</span>
                 }
              </button>
             }
            <a [routerLink]="['/movie', movie.tmdbId]" class="bg-[#00a8c5] text-white px-8 py-3 rounded-xl font-semibold hover:bg-[#0097b2] transition-colors shadow-lg shadow-[#00a8c5]/30">
              View Details
            </a>
          </div>
        </div>
      </div>
    }
  } @else {
    <!-- Loading State -->
    <div class="relative w-full h-[85vh] overflow-hidden bg-[#1a1f26] flex items-center justify-center">
      <div class="text-center">
        <div class="animate-spin w-12 h-12 border-4 border-[#00a8c5] border-t-transparent rounded-full mx-auto mb-4"></div>
        <p class="text-gray-400">Loading movies...</p>
      </div>
    </div>
  }

  <!-- Trending Section -->
  <div class="px-12 mt-4 relative z-20">
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-lg font-bold text-white uppercase tracking-wider">Trending Now</h2>
      <div class="flex gap-2">
         <button (click)="scrollLeft(trendingContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
          </svg>
         </button>
         <button (click)="scrollRight(trendingContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
         </button>
      </div>
    </div>

    <div #trendingContainer class="flex gap-6 overflow-x-auto pb-8 no-scrollbar snap-x scroll-smooth">
      @for (movie of trendingMovies(); track movie.tmdbId) {
        <a [routerLink]="['/movie', movie.tmdbId]" 
           (mouseenter)="setHeroMovie(movie)"
           (mouseleave)="resumeHeroRotation()"
           class="block min-w-[200px] w-[220px] group cursor-pointer snap-start relative">
           
          <div class="absolute top-2 left-2 z-10 bg-black/60 backdrop-blur-md border border-white/10 text-[#00a8c5] text-xs font-bold px-2 py-1 rounded-md flex items-center gap-1 shadow-lg">
            <span class="text-yellow-400">★</span> {{movie.rating.toFixed(1)}}
          </div>

          <div class="relative aspect-[2/3] rounded-2xl overflow-hidden mb-3 shadow-lg transition-transform duration-300 group-hover:scale-105 group-hover:shadow-2xl border border-white/5">
            <img [src]="movie.poster" class="object-cover w-full h-full" alt="{{movie.title}}">
            <div class="absolute inset-0 bg-gradient-to-t from-[#1a1f26]/90 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4">
              <button class="w-full bg-[#00a8c5]/80 backdrop-blur-sm text-white py-2 rounded-lg text-xs font-bold hover:bg-[#00a8c5]">View Info</button>
            </div>
          </div>
          <h3 class="text-white font-medium truncate group-hover:text-[#00a8c5] transition-colors">{{movie.title}}</h3>
          <p class="text-gray-500 text-xs">{{movie.year}}</p>
        </a>
      } @empty {
        <div class="text-gray-500 py-8">No trending movies available</div>
      }
    </div>
  </div>

  <!-- Top Rated Section -->
  <div class="px-12 mt-8 relative z-20">
    <div class="flex items-end justify-between mb-6">
      <h2 class="text-lg font-bold text-white uppercase tracking-wider">Top Rated</h2>
      <div class="flex gap-2">
         <button (click)="scrollLeft(ratedContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
          </svg>
         </button>
         <button (click)="scrollRight(ratedContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
         </button>
      </div>
    </div>

    <div #ratedContainer class="flex gap-6 overflow-x-auto pb-8 no-scrollbar snap-x scroll-smooth">
      @for (movie of topRatedMovies(); track movie.tmdbId) {
        <a [routerLink]="['/movie', movie.tmdbId]" 
           (mouseenter)="setHeroMovie(movie)"
           (mouseleave)="resumeHeroRotation()"
           class="block min-w-[200px] w-[220px] group cursor-pointer snap-start relative">
          <div class="absolute top-2 left-2 z-10 bg-black/60 backdrop-blur-md border border-white/10 text-[#00a8c5] text-xs font-bold px-2 py-1 rounded-md flex items-center gap-1 shadow-lg">
            <span class="text-yellow-400">★</span> {{movie.rating.toFixed(1)}}
          </div>
          <div class="relative aspect-[2/3] rounded-2xl overflow-hidden mb-3 shadow-lg transition-transform duration-300 group-hover:scale-105 group-hover:shadow-2xl border border-white/5">
            <img [src]="movie.poster" class="object-cover w-full h-full" alt="{{movie.title}}">
            <div class="absolute inset-0 bg-gradient-to-t from-[#1a1f26]/90 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4">
              <button class="w-full bg-[#00a8c5]/80 backdrop-blur-sm text-white py-2 rounded-lg text-xs font-bold hover:bg-[#00a8c5]">View Info</button>
            </div>
          </div>
          <h3 class="text-white font-medium truncate group-hover:text-[#00a8c5] transition-colors">{{movie.title}}</h3>
          <p class="text-gray-500 text-xs">{{movie.year}}</p>
        </a>
      } @empty {
        <div class="text-gray-500 py-8">No top rated movies available</div>
      }
    </div>
  </div>

  <!-- Discover / Random Movies Section -->
  <div class="px-12 mt-8 relative z-20">
    <div class="flex items-end justify-between mb-6">
      <div class="flex items-center gap-3">
        <h2 class="text-lg font-bold text-white uppercase tracking-wider">Discover</h2>
        <button (click)="refreshRandomMovies()" class="p-1.5 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-400 hover:text-[#00a8c5] cursor-pointer active:scale-90" title="Shuffle movies">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.992 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182M2.985 19.644l3.181-3.182" />
          </svg>
        </button>
      </div>
      <div class="flex gap-2">
        <button (click)="scrollLeft(discoverContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
          </svg>
        </button>
        <button (click)="scrollRight(discoverContainer)" class="p-2 rounded-full border border-white/20 hover:bg-white/10 transition-colors text-gray-300 hover:text-white cursor-pointer active:scale-95">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
          </svg>
        </button>
      </div>
    </div>

    <div #discoverContainer class="flex gap-6 overflow-x-auto pb-8 no-scrollbar snap-x scroll-smooth">
      @for (movie of randomMovies(); track movie.tmdbId) {
        <a [routerLink]="['/movie', movie.tmdbId]"
           class="block min-w-[200px] w-[220px] group cursor-pointer snap-start relative">
          <div class="relative aspect-[2/3] rounded-2xl overflow-hidden mb-3 shadow-lg transition-transform duration-300 group-hover:scale-105 group-hover:shadow-2xl border border-white/5">
            <img [src]="movie.poster" class="w-full h-full object-cover" [alt]="movie.title">
            <div class="absolute inset-0 bg-gradient-to-t from-[#1a1f26]/90 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex flex-col justify-end p-4">
              <p class="text-gray-200 text-xs leading-relaxed line-clamp-3 mb-2">{{ movie.description }}</p>
              <button class="w-full bg-[#00a8c5]/80 backdrop-blur-sm text-white py-2 rounded-lg text-xs font-bold hover:bg-[#00a8c5]">View Info</button>
            </div>
            <!-- Rating Badge -->
            <div class="absolute top-2 right-2 bg-black/60 backdrop-blur rounded px-1.5 py-0.5 text-[10px] font-bold text-[#00a8c5] border border-white/10">
              ★ {{ movie.rating.toFixed(1) }}
            </div>
          </div>
          <h3 class="text-white font-medium truncate group-hover:text-[#00a8c5] transition-colors">{{ movie.title }}</h3>
          <div class="flex items-center gap-2 text-xs text-gray-500 mt-0.5">
            <span>{{ movie.year }}</span>
            @if (movie.genres.length > 0) {
              <span class="w-1 h-1 bg-gray-600 rounded-full"></span>
              <span class="truncate">{{ movie.genres.slice(0, 2).join(', ') }}</span>
            }
          </div>
        </a>
      } @empty {
        <div class="text-gray-500 py-8">No movies available</div>
      }
    </div>
  </div>

</div>
